/*! 
  JavaScript library for zooming and panning v0.0.2
  ----------------------------------------
  Copyright (c) 2021 Duong Dieu Phap.
  Homepage: https://github.com/d2phap/happla
  Released under the MIT License.

  License information can be found in LICENSE.txt.
 */
!function(t,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define("@d2phap/happla",[],o):"object"==typeof exports?exports["@d2phap/happla"]=o():t["@d2phap/happla"]=o()}(this,(function(){return(()=>{"use strict";var t={d:(o,i)=>{for(var e in i)t.o(i,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:i[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{Board:()=>r,InterpolationMode:()=>i});var i,e=function(){return(e=Object.assign||function(t){for(var o,i=1,e=arguments.length;i<e;i++)for(var n in o=arguments[i])Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}).apply(this,arguments)},n=function(t,o,i,e){return new(i||(i=Promise))((function(n,s){function r(t){try{h(e.next(t))}catch(t){s(t)}}function a(t){try{h(e.throw(t))}catch(t){s(t)}}function h(t){var o;t.done?n(t.value):(o=t.value,o instanceof i?o:new i((function(t){t(o)}))).then(r,a)}h((e=e.apply(t,o||[])).next())}))},s=function(t,o){var i,e,n,s,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,e&&(n=2&s[0]?e.return:s[0]?e.throw||((n=e.return)&&n.call(e),0):e.next)&&!(n=n.call(e,s[1])).done)return n;switch(e=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,e=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){r.label=s[1];break}if(6===s[0]&&r.label<n[1]){r.label=n[1],n=s;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(s);break}n[2]&&r.ops.pop(),r.trys.pop();continue}s=o.call(t,r)}catch(t){s=[6,t],e=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};!function(t){t.Pixelated="pixelated",t.Auto="auto",t.CrispEdges="crisp-edges"}(i||(i={}));var r=function(){function t(t,o,n){this.isPointerDown=!1,this.isMoving=!1,this.arrowLeftDown=!1,this.arrowRightDown=!1,this.arrowUpDown=!1,this.arrowDownDown=!1,this.defaultOptions={imageRendering:i.Pixelated,allowZoom:!0,minZoom:.1,maxZoom:150,zoomFactor:1,panOffset:{x:0,y:0},allowPan:!0,scaleRatio:window.devicePixelRatio,onBeforeContentReady:function(){},onContentReady:function(){},onBeforeZoomChanged:function(){},onAfterZoomChanged:function(){},onAfterTransformed:function(){},onPanning:function(){},onAfterPanned:function(){}},this.elBoard=t,this.elBoardContent=o,this.options=e(e({},this.defaultOptions),n||{}),this.domMatrix=(new DOMMatrix).scaleSelf(this.options.zoomFactor).translateSelf(this.options.panOffset.x,this.options.panOffset.y),this.zoomDistance=this.zoomDistance.bind(this),this.moveDistance=this.moveDistance.bind(this),this.startMoving=this.startMoving.bind(this),this.stopMoving=this.stopMoving.bind(this),this.dpi=this.dpi.bind(this),this.updateImageRendering=this.updateImageRendering.bind(this),this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.zoomTo=this.zoomTo.bind(this),this.panTo=this.panTo.bind(this),this.applyTransform=this.applyTransform.bind(this),this.waitForContentReady=this.waitForContentReady.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.disable(),this.elBoardContent.style.transformOrigin="top left",this.elBoard.style.touchAction="none",this.elBoard.style.overflow="hidden",this.options.onBeforeContentReady()}return Object.defineProperty(t.prototype,"imageRendering",{get:function(){return this.options.imageRendering},set:function(t){this.options.imageRendering=t,this.updateImageRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.options.scaleRatio},set:function(t){this.options.scaleRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoomFactor",{get:function(){return this.options.zoomFactor*this.options.scaleRatio},enumerable:!1,configurable:!0}),t.prototype.onMouseWheel=function(t){if(0!==t.deltaY){var o=t.deltaY<0?"up":"down",i=1+Math.abs(t.deltaY)/300,e="up"===o?i:1/i;this.zoomDistance(e,t.clientX,t.clientY)}},t.prototype.onPointerDown=function(t){0===t.button&&(this.elBoard.setPointerCapture(t.pointerId),this.isPointerDown=!0,this.options.panOffset.x=t.clientX,this.options.panOffset.y=t.clientY)},t.prototype.onPointerMove=function(t){this.isPointerDown&&(this.moveDistance(t.clientX-this.options.panOffset.x,t.clientY-this.options.panOffset.y),this.options.panOffset.x=t.clientX,this.options.panOffset.y=t.clientY,this.options.onPanning(this.domMatrix.e,this.domMatrix.f))},t.prototype.onPointerUp=function(t){this.isPointerDown&&(this.elBoard.releasePointerCapture(t.pointerId),this.isPointerDown=!1,this.options.panOffset.x+=t.clientX-this.options.panOffset.x,this.options.panOffset.y+=t.clientY-this.options.panOffset.y,this.options.onAfterPanned(this.domMatrix.e,this.domMatrix.f))},t.prototype.onKeyDown=function(t){switch(t.key){case"ArrowLeft":this.arrowLeftDown=!0,this.isMoving||(this.isMoving=!0,this.startMoving());break;case"ArrowUp":this.arrowUpDown=!0,this.isMoving||(this.isMoving=!0,this.startMoving());break;case"ArrowRight":this.arrowRightDown=!0,this.isMoving||(this.isMoving=!0,this.startMoving());break;case"ArrowDown":this.arrowDownDown=!0,this.isMoving||(this.isMoving=!0,this.startMoving())}},t.prototype.onKeyUp=function(t){switch(t.key){case"ArrowLeft":this.arrowLeftDown=!1;break;case"ArrowUp":this.arrowUpDown=!1;break;case"ArrowRight":this.arrowRightDown=!1;break;case"ArrowDown":this.arrowDownDown=!1}[this.arrowLeftDown,this.arrowUpDown,this.arrowRightDown,this.arrowDownDown].every((function(t){return!t}))&&this.stopMoving()},t.prototype.dpi=function(t){return t/this.options.scaleRatio},t.prototype.updateImageRendering=function(){switch(this.imageRendering){case i.Auto:this.zoomFactor<=1?this.elBoardContent.style.imageRendering=i.CrispEdges:this.elBoardContent.style.imageRendering=i.Pixelated;break;default:this.elBoardContent.style.imageRendering=this.imageRendering}},t.prototype.moveDistance=function(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.domMatrix.e+=t,this.domMatrix.f+=o,this.options.onPanning(this.domMatrix.e,this.domMatrix.f),this.applyTransform()},t.prototype.zoomDistance=function(t,o,i,e){if(this.options.allowZoom){this.options.zoomFactor=this.domMatrix.a;var n=this.options.zoomFactor,s=n*t;this.options.onBeforeZoomChanged(this.zoomFactor,this.domMatrix.e,this.domMatrix.f),this.options.zoomFactor=Math.min(Math.max(this.options.minZoom,s),this.options.maxZoom);var r=(null!=o?o:this.elBoard.offsetLeft)-this.elBoard.offsetLeft,a=(null!=i?i:this.elBoard.offsetTop)-this.elBoard.offsetTop,h=t;s*this.options.scaleRatio>this.options.maxZoom?(h=this.dpi(this.options.maxZoom)/n,this.options.zoomFactor=this.dpi(this.options.maxZoom)):s*this.options.scaleRatio<this.options.minZoom&&(h=this.dpi(this.options.minZoom)/n,this.options.zoomFactor=this.dpi(this.options.minZoom)),this.domMatrix=(new DOMMatrix).translateSelf(r,a).scaleSelf(h).translateSelf(-r,-a).multiplySelf(this.domMatrix),this.options.onAfterZoomChanged(this.zoomFactor,this.domMatrix.e,this.domMatrix.f),this.updateImageRendering(),this.applyTransform(e)}},t.prototype.startMoving=function(){var t=0,o=0;this.arrowLeftDown&&!this.arrowRightDown?t=20:!this.arrowLeftDown&&this.arrowRightDown&&(t=-20),this.arrowUpDown&&!this.arrowDownDown?o=20:!this.arrowUpDown&&this.arrowDownDown&&(o=-20),this.moveDistance(t,o),this.animationFrame=requestAnimationFrame(this.startMoving)},t.prototype.stopMoving=function(){cancelAnimationFrame(this.animationFrame),this.isMoving=!1},t.prototype.panTo=function(t,o,i){return n(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.domMatrix.e=t,this.domMatrix.f=o,[4,this.applyTransform(i)];case 1:return e.sent(),[2]}}))}))},t.prototype.zoomTo=function(t,o,i,e){return n(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.options.zoomFactor=Math.min(Math.max(this.options.minZoom,this.dpi(t)),this.options.maxZoom),this.options.onBeforeZoomChanged(this.zoomFactor,this.domMatrix.e,this.domMatrix.f),this.domMatrix.a=this.options.zoomFactor,this.domMatrix.d=this.options.zoomFactor,this.domMatrix.e=o||0,this.domMatrix.f=i||0,this.options.onAfterZoomChanged(this.zoomFactor,this.domMatrix.e,this.domMatrix.f),[4,this.applyTransform(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.applyTransform=function(t){var o=this;return void 0===t&&(t=0),new Promise((function(i){if(o.elBoardContent.style.transform=""+o.domMatrix.toString(),t>0){var e="transform "+t+"ms ease, opacity "+t+"ms ease";o.elBoardContent.style.transition=e,setTimeout(i,t)}else o.elBoardContent.style.transition="",i(void 0)})).then((function(){o.options.onAfterTransformed(o.domMatrix)}))},t.prototype.enable=function(){this.applyTransform(),this.elBoard.addEventListener("wheel",this.onMouseWheel,{passive:!0}),this.elBoard.addEventListener("pointerdown",this.onPointerDown),this.elBoard.addEventListener("pointerup",this.onPointerUp),this.elBoard.addEventListener("pointerleave",this.onPointerUp),this.elBoard.addEventListener("pointermove",this.onPointerMove),this.elBoard.addEventListener("keydown",this.onKeyDown),this.elBoard.addEventListener("keyup",this.onKeyUp)},t.prototype.disable=function(){this.elBoard.removeEventListener("mousewheel",this.onMouseWheel),this.elBoard.removeEventListener("pointerdown",this.onPointerDown),this.elBoard.removeEventListener("pointerup",this.onPointerUp),this.elBoard.removeEventListener("pointerleave",this.onPointerUp),this.elBoard.removeEventListener("pointermove",this.onPointerMove),this.elBoard.removeEventListener("keydown",this.onKeyDown),this.elBoard.removeEventListener("keyup",this.onKeyUp)},t.prototype.waitForContentReady=function(){return n(this,void 0,void 0,(function(){var t,o;return s(this,(function(i){switch(i.label){case 0:t=this.elBoardContent.querySelectorAll("img"),o=Array.from(t),i.label=1;case 1:return o.some((function(t){return!t.complete}))?[4,(e=10,new Promise((function(t){return setTimeout(t,e)})))]:[3,3];case 2:return i.sent(),[3,1];case 3:return this.options.onContentReady(),[2]}var e}))}))},t}();return o})()}));
//# sourceMappingURL=main.js.map